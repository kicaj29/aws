# AWS CloudFront basics

* Content Delivery Network (CDN)
* Improves read performance, content is cached at the edge location(s)
* Improves user experience
* 216 Point of Presence globally (edge locations)
* DDOoS protection (because worldwide)
* Integration with Shield, AWS Web Application Firewall


# CloudFront origins

* S3 bucket
  * For distributing files and caching them at the edge
  * Enhanced security with CloudFront Origin Access Control (OAC)
    * OAC is replacing Origin Access Identity (OAI)
  * **CloudFront can be used as an ingress (to upload files to S3)**
    * Is it about "S3 Transfer Acceleration" ? TBD
* Custom Origin (HTTP)
  * ALB
  * EC2 instance
  * S3 website
  * Any HTTP backend you want

# CloudFront architecture at a high level 

>NOTE: a client has to use DNS name created by the CloudFront

![01-cloudFront-arch.png](./images/01-cloudFront-arch.png)


# S3 as origin

![02-cloudFront-arch.png](./images/02-cloudFront-arch.png)

## CloudFront vs S3 Cross Region Replication

* CloudFront
  * Global Edge network
  * Files are cached for a TTL (~day?)
  * Great for static content that must be available everywhere

* S3 Cross Region Replication
  * Must be setup for each region you want replication to happen
  * Files are updated in near real-time
  * Read only
  * Great for dynamic content that needs to be available at low-latency in few regions

# HTTP headers used in CloudFront

## x-cache

This header tells us if the response was served from the CloudFront cache (cache hit) or if a request had to be made to the origin to fetch the content (cache miss).

![03-cloudFront-headers.png](./images/03-cloudFront-headers.png)

Possible values:

* **Hit from CloudFront** – The response was served from the CloudFront cache.
* **Miss from CloudFront** – The request could not be satisfied by an object in the cache, so the server forwarded the request to the origin and returned the result to the viewer.
* **RefreshHit from CloudFront** – The CloudFront server found the object in the cache but the object had expired, so the server contacted the origin to verify that the cache had the latest version of the object.
* **Redirect from CloudFront** – The server redirected the viewer from HTTP to HTTPS according to the distribution settings.
* **Error from CloudFront** – Typically this means the request resulted in either a client error (if the HTTP status code is in the 4XX range) or a server error (if the HTTP status code is in the 5XX range).

## x-amz-cf-id

This response header is an opaque string that uniquely identifies a request. The header is alternatively referred to as the CloudFront Request ID. It is important if you need to later identify a request in your CloudFront access logs or open a support case with AWS Premium Support. CloudFront also sends this header in requests made to your origin.

For troubleshooting issues with a custom origin, you should consider logging these headers at the origin if you are not already doing so.

![04-cloudFront-headers.png](./images/04-cloudFront-headers.png)

## x-amz-cf-pop

This is the edge location that served the request. Each edge location is identified by a three-letter code and an arbitrarily assigned number, such as DFW3.

The three-letter code typically corresponds with the International Air Transport Association (IATA) airport code for an airport near the edge location’s geographic location.

![05-cloudFront-headers.png](./images/05-cloudFront-headers.png)

## server

When diagnosing HTTP errors, this header can be helpful to determine if the error was returned by your origin, or the request generated an error in CloudFront while connecting to your origin.

* If the request generates an error and the server header in the response contains the same value returned by your origin (for example, Amazon S3 returns server: AmazonS3), then CloudFront was able to connect and receive a response from the origin. Errors returned by the origin can be caused by events like increased load, invalid requests from the client, or distribution and origin misconfigurations.

* If the request generates an error and the server value response is `CloudFront`, then the error was generated by CloudFront without an HTTP response from the origin. Errors generated by CloudFront can be due to malformed HTTP requests, issues connecting to the origin, or distribution and origin misconfigurations.

* If the origin does not return a server header at all, CloudFront sets the value of the server header to CloudFront in its response by default.

![06-cloudFront-headers.png](./images/06-cloudFront-headers.png)

# Logs

CloudFront provides two ways for users to collect logs for distributions. Learn more from the following table.

## Standard Logs (Access Logs)

* CloudFront standard logs provide detailed records about every request that is made to a distribution. The logs are useful for many scenarios, such as security and access audits.

* CloudFront standard logs are delivered to the Amazon Simple Storage Service (Amazon S3) bucket of your choice.

* CloudFront doesn't charge for standard logs, although you incur Amazon S3 charges for storing and accessing the log files.

## Real-Time Logs

* CloudFront real-time logs deliver information about requests made to a distribution to an Amazon Kinesis data stream in seconds after receiving requests.

* You can choose the sampling rate for your real-time logs—that is, the percentage of requests for which you want to receive real-time log records. You can also choose the specific fields that you want to receive in the log records.

* CloudFront charges for real-time logs, in addition to the charges you incur for using Kinesis Data Streams.